(()=>{"use strict";class t{constructor(t){this.unsubscribe=[],this.children=[],this.nodeElement=this.createNode(t)}get node(){return this.nodeElement}createNode(t){return this.nodeElement=document.createElement(t.tag),t.css&&this.setClassNames(t.css),t.text&&this.setTextContent(t.text),t.callback&&this.setCallback(t.callback),t.id&&this.setId(t.id),this.node}setClassNames(t){t&&(this.nodeElement.className="",this.nodeElement.classList.add(...t))}addClassName(t){this.node.classList.add(t)}removeCLassName(t){this.node.classList.remove(t)}setTextContent(t){t&&(this.nodeElement.textContent=t)}setCallback(t,e="click"){this.nodeElement.addEventListener(e,t)}setId(t){t&&(this.nodeElement.id=t)}setAttribute(t,e="for"){this.nodeElement.setAttribute(e,t)}addInnerNode(...t){t.forEach((t=>{this.nodeElement.append(t.node),this.children.push(t)}))}removeAllChildren(){this.children.forEach((t=>t.remove()))}saveSubscription(t){this.unsubscribe.push(t)}remove(){this.children&&this.removeAllChildren(),this.unsubscribeFromState(),this.nodeElement.remove()}unsubscribeFromState(){this.unsubscribe.forEach((t=>t()))}}class e{constructor(t=null){this.value=t,this.subscribers=new Set}subscribe(t,e,s){this.subscribers.add(e),s&&e(this.value),t.saveSubscription((()=>this.subscribers.delete(e)))}next(t){this.value=t(this.value),this.notifySubscribers()}notifySubscribers(){this.subscribers.forEach((t=>t(this.value)))}get getValue(){return this.value}clearValue(){this.value=null}}class s{constructor(){this.observables=new Map,this.getFromLocalStorage(),window.addEventListener("beforeunload",(()=>this.saveToLocalStorage()))}static getInstance(){return this.instanceEventEmitter}subscribe(t,e,s,i=!0){this.isObservableExist(e);const o=this.observables.get(e);return o.subscribe(t,s,i),o}next(t,e){this.isObservableExist(t),this.observables.get(t).next(e)}isObservableExist(t){this.observables.has(t)||this.observables.set(t,new e)}saveToLocalStorage(){const t=Array.from(this.observables.entries(),(([t,e])=>[t,e.getValue]));localStorage["rss-puzzle-state"]=JSON.stringify(t)}getFromLocalStorage(){const t=localStorage["rss-puzzle-state"];t&&JSON.parse(t).forEach((([t,s])=>{this.observables.set(t,new e(s))}))}clearState(){this.observables.forEach((t=>t.clearValue()))}}s.instanceEventEmitter=new s;const i=s;class o{constructor(e){this.state=i.getInstance(),this.viewNodeClass=new t(e)}get viewCreator(){return this.viewNodeClass}addNodeInside(...t){t.forEach((t=>{t instanceof o?this.viewNodeClass.addInnerNode(t.viewCreator):this.viewNodeClass.addInnerNode(t)}))}remove(){this.viewNodeClass.remove()}removeAllChildren(){this.viewNodeClass.removeAllChildren()}}class n extends t{constructor(t){super(t),this.setType(t.type),this.setPlaceholder(t.placeholder)}setType(t){this.node instanceof HTMLInputElement&&t&&(this.node.type=t)}setPlaceholder(t){this.node instanceof HTMLInputElement&&t&&this.node.setAttribute("placeholder",t)}}const a={tag:"div",css:["field"]},r={tag:"p",css:["login-notice"]};class l extends o{constructor(t,e,s){super({...a}),this.inputName=t,this.minLength=e,this.actionName=s,this.render()}render(){const e=new t({...r}),s=new n({tag:"input",css:["login-input"],type:"text",placeholder:`Enter your ${this.inputName}`});s.node.autofocus=!0,s.setCallback((()=>{this.inputValidation(s.node.value,e)}),"input"),this.addNodeInside(s,e)}inputValidation(t,e){return e.setTextContent(" "),t.length?t&&!/^[a-zA-Z-^]+$/.test(t)?(e.setTextContent("Use only english letters"),void this.state.next(this.actionName,(()=>null))):t&&t[0]!==t[0].toUpperCase()||"-"===t[0]?(e.setTextContent("The first letter must be uppercase"),void this.state.next(this.actionName,(()=>null))):t&&t.length<this.minLength?(e.setTextContent(`${this.inputName} is too short`),void this.state.next(this.actionName,(()=>null))):void(t&&this.state.next(this.actionName,(()=>t))):(e.setTextContent(" "),void this.state.next(this.actionName,(()=>null)))}}const c={tag:"div",css:["login-page"]},h={tag:"button",css:["login-button"],text:"sing in"},d={tag:"div",css:["login-page__container"]};class u extends o{constructor(){super({...c}),this.isNameValid=null,this.isSurNameValid=null,this.render()}render(){this.generateLoginForm()}generateLoginForm(){const e=new t({...d}),s=new l("First name",3,"validFirstName"),i=new l("Surname",4,"validSurname"),o=new t({...h,tag:"button",callback:()=>this.submitUserData()});e.addInnerNode(s.viewCreator,i.viewCreator,o),this.addNodeInside(e),this.makeSubscription(o)}makeSubscription(t){const{node:e}=t;this.state.subscribe(this.viewCreator,"validFirstName",(t=>{this.isNameValid=t,e.disabled=!(this.isNameValid&&this.isSurNameValid)})).next((()=>null)),this.state.subscribe(this.viewCreator,"validSurname",(t=>{this.isSurNameValid=t,e.disabled=!(this.isNameValid&&this.isSurNameValid)})).next((()=>null))}submitUserData(){this.state.next("loginData",(()=>"string"!=typeof this.isNameValid||"string"!=typeof this.isSurNameValid?null:[this.isNameValid,this.isSurNameValid]))}}const m={tag:"div",css:["start-screen__container"]},v={tag:"h1",css:["start-screen__title"],text:"english puzzle"},w={tag:"h2",css:["start-screen__greeting"]},g={tag:"p",css:["start-screen__description"],text:"Click on words, collect phrases. You can drag and drop words. Select tooltip in the menu"},b={tag:"button",css:["start-screen-button","start-screen-button__start"],text:"start"},p={tag:"button",css:["start-screen-button","start-screen-button__log-out"],text:"log out"};class f extends o{constructor(t){super({tag:"div",css:["start-screen"]}),this.render(t)}render(e){const s=new t({...m}),i=new t({...v}),o=new t({...g}),n=new t({...w}),a=new t({...b,tag:"button",callback:()=>e()}),r=new t({...p,callback:()=>this.state.next("loginData",(()=>null))});s.addInnerNode(i,n,o,a,r),this.viewCreator.addInnerNode(s),this.state.subscribe(this.viewCreator,"loginData",(t=>{n.setTextContent(`Hello, ${t?.join(" ")}!`)})),this.state.subscribe(this.viewCreator,"collectionLoaded",(t=>{a.node.disabled=!t}))}}const C={tag:"button",css:["header__button","logout-button"]},x={tag:"button",css:["header__button","burger-button"]};class z extends o{constructor(){super({tag:"header",css:["header"]}),this.render()}render(){let e=0,s=0;const i=new t({tag:"p",css:["mode"]});this.state.subscribe(this.viewCreator,"gameDifficulty",(t=>{e="number"==typeof t?t:0,i.setTextContent(`Level: ${e+1}   Round: ${s+1}`)})),this.state.subscribe(this.viewCreator,"gameRound",(t=>{s="number"==typeof t?t:0,i.setTextContent(`Level: ${e+1}   Round: ${s+1}`)})),this.addNodeInside(this.logoutBtn(),i,this.toggleBurgerMenu())}logoutBtn(){const e=new t({...C,callback:()=>this.state.next("loginData",(()=>null))});return e.setAttribute("Logout","title"),e}toggleBurgerMenu(){const e=new t({...x,callback:()=>this.state.next("toggleBurgerMenu",(t=>!!t))}),s=new t({tag:"span"});return e.addInnerNode(s),e}}const N="puzzle-item_active";class y extends o{constructor(t,e,s,i,o,n,a){super({tag:"div",css:["puzzle-item","puzzle-item_active"],text:t}),this.isAllowedToMove=!0,this.shiftX=0,this.shiftY=0,this.nodeWidth=0,this.nodeHeight=0,this.coordsForReturn={x:0,y:0},this.clickTime=0,this.onTouchStart=this.onMouseDown.bind(this),this.onDownFunc=this.onMouseDown.bind(this),this.onMoveFunc=this.moveItem.bind(this),this.mouseUpFunc=this.resetItem.bind(this),this.isBgActive=!1,this.bgSrc=o,this.bgOrder=i,this.onClick=n,this.placeholder=a,this.viewCreator.node.style.setProperty("--width",`${e.toFixed(2)}`),this.viewCreator.node.style.setProperty("--bgShift",`${s.toFixed(2)}`),this.viewCreator.node.addEventListener("mousedown",this.onDownFunc),this.viewCreator.node.addEventListener("touchstart",this.onTouchStart),this.state.subscribe(this.viewCreator,"isAllowedToMovePuzzle",(t=>{this.isAllowedToMove=t??!1}),!1),this.state.subscribe(this.viewCreator,"showPuzzleBg",(t=>t?this.addBackground(null,i):this.addBackground(o,i)))}onMouseDown(t){this.isAllowedToMove&&(this.state.next("isAllowedToMovePuzzle",(()=>null)),this.setCoordsForReturn(),this.clickTime=(new Date).getTime(),t instanceof MouseEvent?(this.prepareToDrag(t),window.addEventListener("mousemove",this.onMoveFunc),window.addEventListener("mouseup",this.mouseUpFunc)):(this.insteadOfClick(t),window.addEventListener("touchmove",this.onMoveFunc),window.addEventListener("touchend",this.mouseUpFunc)))}prepareToDrag(t){const{left:e,top:s,width:i,height:o}=this.viewCreator.node.getBoundingClientRect();[this.shiftX,this.shiftY]=[t.clientX-e,t.clientY-s],[this.nodeWidth,this.nodeHeight]=[i,o],Object.assign(this.viewCreator.node.style,{position:"absolute",left:t.pageX-this.shiftX+"px",top:t.pageY-this.shiftY+"px",pointerEvents:"none"}),this.viewCreator.node.parentNode?.insertBefore(this.placeholder.node,this.viewCreator.node),this.setPlaceholderWidth(i)}moveItem(t){let e;if(t instanceof MouseEvent&&(e=t),t instanceof TouchEvent&&([e]=[t.touches[0]]),e&&e.target instanceof HTMLElement){Object.assign(this.viewCreator.node.style,{left:`${Math.min(e.pageX-this.shiftX,window.innerWidth-this.nodeWidth)}px`,top:`${Math.min(e.pageY-this.shiftY,window.innerHeight-this.nodeHeight)}px`});const t=document.elementFromPoint(this.viewCreator.node.offsetLeft,e.clientY);let s=0,i=null;t&&t.classList.contains(N)?i=document.elementFromPoint(this.viewCreator.node.offsetLeft,e.clientY):(s=this.nodeWidth,i=document.elementFromPoint(this.viewCreator.node.offsetLeft+this.nodeWidth,e.clientY)),i&&i.classList.contains(N)&&(this.isInsertBefore(i,s)?i.parentNode?.insertBefore(this.placeholder.node,i):i.parentNode?.insertBefore(this.placeholder.node,i.nextSibling))}}onMouseup(t){if((new Date).getTime()-this.clickTime<100)return this.onClick(this.viewCreator.node),this.smoothMovement(),void this.smoothlyHidePlaceholder();let{target:e}=t;if(t instanceof TouchEvent&&(this.viewCreator.node.style.display="none",e=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY),this.viewCreator.node.style.display="flex"),e instanceof HTMLElement&&e.classList.contains("placeholder"))return e.parentNode?.insertBefore(this.viewCreator.node,this.placeholder.node),void this.smoothOnReplace();e instanceof HTMLElement&&e.classList.contains("puzzle-row_active")&&(e.append(this.viewCreator.node),this.smoothlyHidePlaceholder()),this.smoothMovement()}insteadOfClick(t){t instanceof TouchEvent&&this.prepareToDrag(t.touches[0])}smoothMovement(){this.viewCreator.node.style.position="static";const{offsetLeft:t,offsetTop:e}=this.viewCreator.node;Object.assign(this.viewCreator.node.style,{position:"absolute",left:`${this.coordsForReturn.x}px`,top:`${this.coordsForReturn.y}px`}),this.coordsForReturn={x:t,y:e}}smoothOnReplace(){const{offsetLeft:t,offsetTop:e}=this.placeholder.node;this.coordsForReturn={x:t,y:e}}smoothlyHidePlaceholder(){Object.assign(this.placeholder.node.style,{transition:"all linear 0.3s",width:"0px"})}resetItem(t){this.onMouseup(t),Object.assign(this.viewCreator.node.style,{position:"absolute",transition:"all linear 0.3s",left:`${this.coordsForReturn.x}px`,top:`${this.coordsForReturn.y}px`}),setTimeout((()=>{this.placeholder.remove(),this.viewCreator.node.style.removeProperty("position"),this.viewCreator.node.style.removeProperty("pointer-events"),this.viewCreator.node.style.removeProperty("transition"),this.state.next("afterItemMoving",(t=>t)),this.state.next("isAllowedToMovePuzzle",(()=>!0))}),300),t instanceof MouseEvent?(window.removeEventListener("mouseup",this.mouseUpFunc),window.removeEventListener("mousemove",this.onMoveFunc)):(window.removeEventListener("touchend",this.mouseUpFunc),window.removeEventListener("touchmove",this.onMoveFunc))}setPlaceholderWidth(t){this.placeholder.node.style.width=`${t}px`}isInsertBefore(t,e){const{width:s,left:i}=t.getBoundingClientRect(),o=s/2+i;return this.viewCreator.node.offsetLeft+e<o}makeItemInactive(){this.viewCreator.removeCLassName("puzzle-item_active"),this.viewCreator.node.removeEventListener("mousedown",this.onDownFunc),this.viewCreator.node.removeEventListener("touchstart",this.onTouchStart),this.viewCreator.unsubscribeFromState(),this.isBgActive||this.addBackground(this.bgSrc,this.bgOrder)}setCoordsForReturn(){const{offsetLeft:t,offsetTop:e}=this.viewCreator.node;this.coordsForReturn={x:t,y:e}}addBackground(t,e){if(t){const s=`https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/images/${t}`,i=new Image;return i.src=s,void(i.onload=()=>{this.viewCreator.node.style.backgroundImage=`url(${s})`,this.viewCreator.node.style.backgroundPositionY=11.11*e+"%",this.isBgActive=!0})}this.isBgActive=!1,this.viewCreator.node.style.removeProperty("background-image")}autocomplete(t){t&&(t.append(this.viewCreator.node),this.makeItemInactive())}hideTextAndBorder(){this.viewCreator.addClassName("puzzle-item_hide")}}class k extends o{constructor(){super({tag:"div",css:["puzzle-row"]})}makeActive(t){t?this.viewCreator.addClassName("puzzle-row_active"):this.viewCreator.removeCLassName("puzzle-row_active")}}const S={tag:"button",css:["game-controls_button"],text:"continue"},L={tag:"button",css:["game-controls_button"],text:"don't know"},E={tag:"button",css:["game-controls_button"],text:"check"},I={tag:"button",css:["game-controls_button"],text:"continue"},_={tag:"button",css:["game-controls_button"],text:"results"};class T extends o{constructor(t,e){super({tag:"div",css:["game-controls"]}),this.checkSentence=t,this.autoComplete=e,this.render()}render(){const e=new t({...S}),s=new t({...L,tag:"button"}),i=new t({...E,tag:"button"}),o=new t({...I,tag:"button"}),n=new t({..._,tag:"button",callback:()=>{this.state.next("showStatistics",(t=>t))}});i.setCallback((()=>{this.checkSentence()&&(i.remove(),this.addNodeInside(e))})),e.setCallback((()=>{this.state.next("nextLevel",(()=>1)),e.remove(),s.node.disabled=!1,this.addNodeInside(i)})),s.setCallback((()=>{i.remove(),this.addNodeInside(e),this.autoComplete(),s.node.disabled=!0})),o.setCallback((()=>{this.state.next("gameRound",(t=>t+1))})),this.addNodeInside(s,i),this.state.subscribe(s,"blockStupidButton",(t=>{s.node.disabled=!!t})).next((()=>!1)),this.state.subscribe(this.viewCreator,"addNextRoundButton",(()=>{s.remove(),e.node.style.display="none",this.addNodeInside(o,n)}),!1),this.state.subscribe(this.viewCreator,"checkSentence",(t=>{i.node.disabled=!!t})).next((()=>!0))}}class B extends o{constructor(t=null){super({tag:"button",css:["audio-hint"],callback:()=>this.playAudio()}),this.audioSrc=t}playAudio(){if(!this.audioSrc)return;this.viewCreator.node.disabled=!0;const t=new Audio;t.src=`https://github.com/rolling-scopes-school/rss-puzzle-data/raw/main/${this.audioSrc}`,t.play(),t.onended=()=>{this.viewCreator.node.disabled=!1}}set setAudioSrc(t){this.audioSrc=t}}const P={tag:"div",css:["placeholder"]},R={tag:"div",css:["all-rows"]},A={tag:"div",css:["start-zone","puzzle-row","puzzle-row_active"]},M={tag:"p",css:["translation-hint"]};class F extends o{constructor(e){super({tag:"div",css:["game","drag-area"]}),this.gameData=e,this.translationHint=new t({...M}),this.audioHint=new B,this.allRowsBlock=new t({...R}),this.startBlock=new t({...A}),this.placeHolder=new t({...P}),this.allPuzzles=[],this.puzzleRows=[],this.currentLvlPuzzles=[],this.resultBlock=null,this.currentSentence=[],this.level=-1,this.render(),this.state.subscribe(this.viewCreator,"nextLevel",(()=>this.nextLevel())),this.state.subscribe(this.viewCreator,"afterItemMoving",(()=>this.isStartBLockEmpty()),!1).next((()=>!0)),this.state.subscribe(this.viewCreator,"showTranslationHint",(t=>t?this.translationHint.remove():this.addNodeInside(this.translationHint))),this.state.subscribe(this.viewCreator,"showAudioHint",(t=>t?this.audioHint.remove():this.addNodeInside(this.audioHint))),this.state.next("unresolvedSentences",(()=>[]))}render(){this.createPuzzleRows(),this.addNodeInside(this.allRowsBlock,this.startBlock,new T((()=>this.checkSentence()),(()=>this.autoComplete())).viewCreator)}createPuzzleRows(){this.gameData.words.forEach((()=>{const t=new k;this.puzzleRows.push(t),this.allRowsBlock.addInnerNode(t.viewCreator)}))}createPuzzleItems(t=this.gameData){const e=t.words[this.level];this.translationHint.setTextContent(e.textExampleTranslate),this.audioHint.setAudioSrc=e.audioExample,this.currentSentence=e.textExample.split(" ");const s=100/e.textExample.replaceAll(" ","").length;let i=0;this.currentSentence.forEach((e=>{const o=s*e.length,n=new y(e,o,i,this.level,t.levelData.imageSrc,(t=>this.moveItemBetweenRows(t)),this.placeHolder);i+=o,this.allPuzzles.push(n),this.currentLvlPuzzles.push(n)})),[...this.currentLvlPuzzles].sort((()=>.5-Math.random())).forEach((t=>this.startBlock.addInnerNode(t.viewCreator)))}nextLevel(){this.level+=1,this.level>9||(this.currentLvlPuzzles=[],this.allPuzzles.forEach((t=>t.makeItemInactive())),this.makeActiveRow(),this.resultBlock=this.puzzleRows[this.level],this.createPuzzleItems(),this.state.next("checkSentence",(()=>!0)),this.state.next("showTranslationHint",(t=>t)))}moveItemBetweenRows(t){[...this.startBlock.node.children].some((e=>e===t))?this.resultBlock?.viewCreator.node.append(t):this.startBlock.node.append(t)}isStartBLockEmpty(){const t=this.startBlock.node.children.length;this.state.next("checkSentence",(()=>!!t))}checkSentence(){const t=this.resultBlock?.viewCreator.node.children;if(!t?.length)return!1;let e=!0;return this.currentSentence.forEach(((s,i)=>{s!==t[i].textContent?(e=!1,t[i].classList.add("puzzle-item_incorrect")):t[i].classList.add("puzzle-item_correct"),t[i].addEventListener("animationend",(()=>{t[i].classList.remove("puzzle-item_correct"),t[i].classList.remove("puzzle-item_incorrect")}))})),e?(this.state.next("blockStupidButton",(()=>!0)),this.currentLvlPuzzles.forEach((t=>t.autocomplete(this.resultBlock?.viewCreator.node))),this.addNodeInside(this.translationHint),this.level>=9&&this.onCompleteRound(),e):e}autoComplete(){this.currentLvlPuzzles.length&&(this.currentLvlPuzzles.forEach((t=>t.autocomplete(this.resultBlock?.viewCreator.node))),this.state.next("unresolvedSentences",(t=>t?[...t,this.level]:[])),this.addNodeInside(this.translationHint),this.level>=9&&this.onCompleteRound())}makeActiveRow(){this.puzzleRows.forEach(((t,e)=>t.makeActive(e===this.level)))}onCompleteRound(){this.state.next("addNextRoundButton",(()=>!0)),this.state.next("saveCompletedGame",(t=>t)),this.state.next("closeBurger",(t=>!t)),setTimeout((()=>{this.allPuzzles.forEach((t=>t.hideTextAndBorder())),this.showImageInfo()}),3e3)}showImageInfo(){const{author:t,name:e,year:s}=this.gameData.levelData;this.startBlock.addClassName("puzzle-row_text"),this.startBlock.setTextContent(`${t} - ${e} (${s})`)}}class H extends o{constructor(t){super({tag:"li",css:["statistics-item"]}),this.render(t)}render(e){const s=new B(e.audioExample),i=new t({tag:"p",css:["statistics-item__text"],text:e.textExample});this.addNodeInside(s,i)}}class $ extends o{constructor(t,e){super({tag:"div",css:["statistics-group"]}),this.render(t,e)}render(e,s){const i=new t({tag:"div",css:["statistics-group__title"],text:e});i.setAttribute(`${s.length}`,"amount");const o=new t({tag:"ul",css:["statistics-group__list"]});s.forEach((t=>o.addInnerNode(new H(t).viewCreator))),this.addNodeInside(i,o)}}const D="https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/images/";class V extends o{constructor(t){super({tag:"div",css:["statisctics__info"]}),this.render(t)}render(e){const s=new t({tag:"p",css:["statistics__text"],text:`${e.author} - ${e.name}. (${e.year})`}),i=new t({tag:"div",css:["statistics__image"]}),o=new Image;o.src=`${D}${e.cutSrc}`,o.onload=()=>{i.node.style.backgroundImage=`url(${D}${e.cutSrc})`},this.addNodeInside(i,s)}}class O extends o{constructor(t){super({tag:"div",css:["statistics"]}),this.data=t,this.unresolvedSentences=[],this.state.subscribe(this.viewCreator,"unresolvedSentences",(t=>{Array.isArray(t)&&(this.unresolvedSentences=t)})),this.render()}render(){const e=[],s=new t({tag:"div",css:["group-container"]}),i=new V(this.data.levelData);if(e.push(i.viewCreator),10!==this.unresolvedSentences.length){const t=new $("You Know:",this.data.words.filter(((t,e)=>!this.unresolvedSentences.includes(e))));s.addInnerNode(t.viewCreator)}if(0!==this.unresolvedSentences.length){const t=new $("You don't Know:",this.data.words.filter(((t,e)=>this.unresolvedSentences.includes(e))));s.addInnerNode(t.viewCreator)}const o=new t({tag:"button",text:"Continue",css:["statistics-button"],callback:()=>this.state.next("gameRound",(t=>t+1))});e.push(s,o),this.addNodeInside(...e)}}const Y={tag:"button",css:["menu__button","translation-button"]},j={tag:"button",css:["menu__button","audio-button"]},G={tag:"button",css:["menu__button","puzzle-bg-button"]},U={tag:"button",css:["menu-close"]},W={tag:"p",css:["menu-title"],text:"Levels"},X={tag:"p",css:["menu-title"],text:"Rounds"},J={tag:"div",css:["level-selector"]},K={tag:"div",css:["round-selector"]},Z={tag:"div",css:["difficulty-selector"]};class q extends o{constructor(t){super({tag:"div",css:["menu","menu_open-animation"]}),this.collection=t,this.viewCreator.setCallback((()=>{this.viewCreator.removeCLassName("menu_open-animation")}),"animationend"),this.render(),this.state.subscribe(this.viewCreator,"closeBurger",(()=>this.closeMenu()),!1)}render(){const e=new t({...U,callback:()=>this.closeMenu()});this.addNodeInside(this.translationHint(),this.audioHint(),this.backgroundHint(),this.addDifficultySelector(),e)}closeMenu(){this.viewCreator.addClassName("menu_close-animation"),this.viewCreator.setCallback((()=>{this.viewCreator.remove()}),"animationend")}translationHint(){const e=new t({...Y,callback:()=>this.state.next("showTranslationHint",(t=>!t))});return e.setAttribute("Show translation hint","title"),this.state.subscribe(e,"showTranslationHint",(t=>t?e.removeCLassName("menu-button_active"):e.addClassName("menu-button_active"))),e}audioHint(){const e=new t({...j,callback:()=>this.state.next("showAudioHint",(t=>!t))});return e.setAttribute("Show audio hint","title"),this.state.subscribe(e,"showAudioHint",(t=>t?e.removeCLassName("menu-button_active"):e.addClassName("menu-button_active"))),e}backgroundHint(){const e=new t({...G,callback:()=>this.state.next("showPuzzleBg",(t=>!t))});return e.setAttribute("Enable or disable background image hint","title"),this.state.subscribe(e,"showPuzzleBg",(t=>t?e.removeCLassName("menu-button_active"):e.addClassName("menu-button_active"))),e}addDifficultySelector(){const e=new t({...Z}),s=new t({...W}),i=new t({...X}),o=new t({...J}),n=new t({...K});let a={};this.state.subscribe(e,"completedGames",(t=>{a=t||{}}));const r=[];return this.collection.forEach(((e,s)=>{const i=new t({tag:"button",css:["difficulty-button"],text:`${s+1}`});i.setCallback((()=>{[...o.node.children].forEach((t=>t.classList.remove("difficulty-button__active"))),i.addClassName("difficulty-button__active"),this.addRoundSelector(this.collection[s],s,a,n)})),r.push(i)})),o.addInnerNode(...r),this.state.subscribe(this.viewCreator,"gameDifficulty",(t=>{if("number"==typeof t){if(t>this.collection.length-1)return;r[t].addClassName("difficulty-button__active"),this.addRoundSelector(this.collection[t],t,a,n)}})),e.addInnerNode(s,o,i,n),e}addRoundSelector(e,s,i,o){const n=new Set(i[s]);o.removeAllChildren(),e.rounds.forEach(((e,i)=>{const a=new t({tag:"button",text:`${i+1}`,css:["round-button"],callback:()=>{this.state.next("gameDifficulty",(()=>s)),this.state.next("gameRound",(()=>i)),this.closeMenu()}});n.has(i)&&a.addClassName("round-button_completed"),o.addInnerNode(a)}))}}class Q extends o{constructor(t){super({tag:"div",css:["game-page"]}),this.collection=t,this.activeViews=[],this.round=0,this.difficulty=0,this.state.next("lastCompletedGame",(t=>(this.state.next("gameDifficulty",(()=>t?t.difficulty:0)),this.state.next("gameRound",(()=>t?t.round:0)),t))),this.state.subscribe(this.viewCreator,"gameDifficulty",(t=>{"number"==typeof t&&t>=0&&(t>this.collection.length-1?this.state.next("gameDifficulty",(()=>0)):this.difficulty=t)})),this.state.subscribe(this.viewCreator,"gameRound",(t=>{"number"==typeof t&&(this.round=t,this.nextRound())})),this.state.subscribe(this.viewCreator,"showStatistics",(()=>this.renderStatistics()),!1),this.state.subscribe(this.viewCreator,"saveCompletedGame",(()=>this.saveCompletedGame()),!1),this.state.subscribe(this.viewCreator,"toggleBurgerMenu",(()=>this.addNodeInside(new q(this.collection))),!1)}nextRound(){if(this.collection)return this.round>this.collection[this.difficulty].roundsCount-1?(this.state.next("gameDifficulty",(t=>"number"==typeof t?t+1:0)),void this.state.next("gameRound",(()=>0))):void this.renderGame(this.collection[this.difficulty].rounds[this.round])}renderGame(t){t&&(this.clearGamePage(),this.activeViews.push(new z,new F(t)),this.addNodeInside(...this.activeViews))}renderStatistics(){this.clearGamePage(),this.activeViews.push(new O(this.collection[this.difficulty].rounds[this.round])),this.addNodeInside(...this.activeViews)}saveCompletedGame(){this.state.next("lastCompletedGame",(()=>({difficulty:this.difficulty,round:this.round}))),this.state.next("completedGames",(t=>{const e=t||{};return e[this.difficulty]?e[this.difficulty].push(this.round):e[this.difficulty]=[this.round],e}))}clearGamePage(){this.activeViews.forEach((t=>t.remove())),this.activeViews=[]}}class tt{async fetch(t){try{const e=await fetch(`${t}`);return await e.json()}catch(e){throw new Error(`Error: ${e}, ${t} is not available`)}}}const et=["https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel1.json","https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel2.json","https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel3.json","https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel4.json","https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel5.json","https://raw.githubusercontent.com/rolling-scopes-school/rss-puzzle-data/main/data/wordCollectionLevel6.json"];class st extends o{constructor(){super({tag:"div",css:["app"]}),this.activePage=null,this.httpClient=new tt,this.collection=[],this.configureView(),this.getAllJson(et)}configureView(){this.state.subscribe(this.viewCreator,"loginData",(t=>{if(!t)return this.render(new u),void this.state.clearState();this.render(new f((()=>this.render(new Q(this.collection)))))}))}render(t){this.collection.length&&this.state.next("collectionLoaded",(()=>!0)),this.activePage?.remove(),this.activePage=t,this.addNodeInside(this.activePage)}async getAllJson(t){this.state.next("collectionLoaded",(()=>!1));const e=await Promise.all(t.map((t=>this.httpClient.fetch(t))));this.collection=e,this.state.next("collectionLoaded",(()=>!0))}}(new class{constructor(){this.main=new st}start(){document.body.append(this.main.viewCreator.node)}}).start()})();